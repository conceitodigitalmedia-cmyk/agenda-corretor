<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Corretor - Full Ultra</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
body{background:#121212;color:#fff;padding:20px;min-height:100vh;}
h1,h2{text-align:center;margin-bottom:20px;}
#homeDiv{max-width:500px;margin:50px auto;text-align:center;}
#homeDiv button{width:80%;margin:10px;padding:15px;border:none;border-radius:8px;font-size:1em;cursor:pointer;transition:.3s;color:#fff;}
#btnCadastro{background:#3399ff;} #btnCadastro:hover{background:#66b3ff;}
#btnLogin{background:#4caf50;} #btnLogin:hover{background:#66d36f;}
#btnCliente{background:#ff9800;} #btnCliente:hover{background:#ffb366;}
.box{max-width:400px;margin:50px auto;background:#1e1e1e;padding:30px;border-radius:10px;box-shadow:0 0 20px rgba(255,0,128,0.3);}
.box input{width:100%;padding:12px;margin:10px 0;border-radius:6px;border:none;background:#2c2c2c;color:#fff;}
.box button{width:100%;padding:12px;border:none;border-radius:6px;background:#ff3399;color:#fff;font-weight:bold;cursor:pointer;transition:.3s;}
.box button:hover{background:#ff66b3;}
#panelDiv,#clientDiv,#registerDiv,#loginDiv{display:none;}
.welcome{text-align:center;margin-bottom:20px;color:#ff66b3;font-size:1.2em;}
.form-imovel,.form-schedule{max-width:700px;margin:20px auto;display:flex;gap:10px;flex-wrap:wrap;}
.form-imovel input,.form-imovel textarea,.form-imovel button,.form-schedule input,.form-schedule button{flex:1 1 150px;padding:10px;border-radius:6px;border:none;}
.form-imovel textarea{flex-basis:100%;background:#2c2c2c;color:#fff;resize:none;}
.form-imovel button,.form-schedule button{background:#ff3399;color:#fff;font-weight:bold;cursor:pointer;transition:.3s;}
.form-imovel button:hover,.form-schedule button:hover{background:#ff66b3;}
.cards-container{max-width:1000px;margin:30px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;}
.card{background:#1e1e1e;padding:20px;border-radius:10px;border:2px solid #ff3399;transition:.3s;position:relative;}
.card:hover{border-color:#ff66b3;transform:translateY(-5px);}
.card h3{color:#ff66b3;margin-bottom:10px;}
.card p{margin:5px 0;}
.edit-btn,.remove-btn{position:absolute;top:10px;padding:5px 8px;border:none;border-radius:6px;cursor:pointer;transition:.3s;color:#fff;}
.edit-btn{right:50px;background:#3399ff;} .edit-btn:hover{background:#66b3ff;}
.remove-btn{right:10px;background:#ff3333;} .remove-btn:hover{background:#ff6666;}
.schedule{max-width:700px;margin:20px auto;display:grid;grid-template-columns:repeat(7,1fr);gap:5px;text-align:center;}
.slot{padding:10px;border-radius:6px;cursor:pointer;}
.available{background:#4caf50;} .occupied{background:#f44336;} .personal{background:#ff9800;}
.img-container{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px;}
.img-container img{width:48%;border-radius:6px;}
</style>
</head>
<body>

<div id="homeDiv">
  <h1>Agenda Corretor</h1>
  <button id="btnCadastro" onclick="showRegister()">Cadastro Corretor</button>
  <button id="btnLogin" onclick="showLogin()">Login Corretor</button>
  <button id="btnCliente" onclick="showClient()">Acesso Cliente</button>
</div>

<div id="registerDiv" class="box">
  <h2>Cadastro Corretor</h2>
  <input type="text" id="nome" placeholder="Nome (obrigatório)">
  <input type="email" id="email" placeholder="E-mail">
  <input type="text" id="telefone" placeholder="Telefone (obrigatório)">
  <input type="text" id="creci" placeholder="CRECI (obrigatório)">
  <input type="password" id="senha" placeholder="Senha (obrigatório)">
  <button onclick="registerCorretor()">Cadastrar</button>
  <button onclick="backHome()">Voltar</button>
  <p id="registerMsg" style="color:green;text-align:center;"></p>
</div>

<div id="loginDiv" class="box">
  <h2>Login Corretor</h2>
  <input type="text" id="username" placeholder="Usuário">
  <input type="password" id="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <p id="loginError" style="color:red;text-align:center;"></p>
</div>

<div id="panelDiv">
  <h1>Bem-vindo à Agenda do Corretor</h1>
  <h2 class="welcome" id="welcome"></h2>

  <div class="form-imovel">
    <input type="text" id="imovel" placeholder="Nome do imóvel">
    <input type="text" id="preco" placeholder="Preço">
    <input type="text" id="endereco" placeholder="Endereço / Cidade">
    <input type="text" id="site" placeholder="Site do imóvel">
    <textarea id="descricao" placeholder="Descrição"></textarea>
    <input type="text" id="foto1" placeholder="Link Foto 1">
    <input type="text" id="foto2" placeholder="Link Foto 2">
    <input type="text" id="foto3" placeholder="Link Foto 3">
    <input type="text" id="foto4" placeholder="Link Foto 4">
    <input type="text" id="foto5" placeholder="Link Foto 5">
    <input type="text" id="foto6" placeholder="Link Foto 6">
    <input type="text" id="foto7" placeholder="Link Foto 7">
    <input type="text" id="foto8" placeholder="Link Foto 8">
    <input type="text" id="foto9" placeholder="Link Foto 9">
    <input type="text" id="foto10" placeholder="Link Foto 10">
    <button onclick="addOrUpdateImovel()">Adicionar/Atualizar Imóvel</button>
  </div>

  <div class="cards-container" id="cardsContainer"></div>
  <div class="schedule" id="scheduleContainer"></div>

  <div style="text-align:center;margin-top:20px;">
    <p>Link individual do corretor para clientes:</p>
    <input type="text" id="linkCorretor" style="width:80%;padding:10px;" readonly>
  </div>
</div>

<div id="clientDiv">
  <h1>Painel Cliente</h1>
  <div class="cards-container" id="clientCards"></div>
</div>

<script>
const sheetUrl="https://api.sheetbest.com/sheets/5c119db8-bebe-428a-9f10-be9c58262adf";
const headers = {
  "Content-Type": "application/json",
  "Authorization": "S@r@kOI_%lZFzQd!d7@bkSdQw#$oI9cdB57yarmlf_Z$0i3H29BzpamszZeZdK2n"
};
let currentUser=null;

// ---------- Navegação ----------
function showLogin(){ hideAll(); document.getElementById("loginDiv").style.display="block"; }
function showRegister(){ hideAll(); document.getElementById("registerDiv").style.display="block"; }
function showClient(){ hideAll(); document.getElementById("clientDiv").style.display="block"; }
function hideAll(){ document.getElementById("homeDiv").style.display="none"; document.getElementById("loginDiv").style.display="none"; document.getElementById("registerDiv").style.display="none"; document.getElementById("panelDiv").style.display="none"; document.getElementById("clientDiv").style.display="none";}
function backHome(){ hideAll(); document.getElementById("homeDiv").style.display="block"; }

// ---------- Cadastro ----------
async function registerCorretor(){
  const nome=document.getElementById("nome").value.trim();
  const email=document.getElementById("email").value.trim();
  const telefone=document.getElementById("telefone").value.trim();
  const creci=document.getElementById("creci").value.trim();
  const senha=document.getElementById("senha").value.trim();
  if(!nome||!telefone||!creci||!senha){ alert("Preencha todos os campos obrigatórios!"); return; }

  const res = await fetch(sheetUrl,{headers}); 
  const data = await res.json();
  if(data.find(u=>u.nome===nome)){ alert("Corretor já cadastrado!"); return; }

  await fetch(sheetUrl,{
    method:"POST",
    headers: headers,
    body: JSON.stringify({nome,email,telefone,creci,senha,username:nome.toLowerCase()})
  });

  document.getElementById("registerMsg").innerText="Corretor cadastrado com sucesso!";
  document.getElementById("linkCorretor").value=`${location.origin}${location.pathname}?user=${nome.toLowerCase()}`;
}

// ---------- Login ----------
async function login(){
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  const res = await fetch(sheetUrl,{headers}); 
  const data = await res.json();
  const user = data.find(u=>u.username===username && u.senha===password);
  if(user){
    currentUser=user; hideAll(); document.getElementById("panelDiv").style.display="block";
    document.getElementById("welcome").innerText=`Bem-vindo, ${user.nome}`;
    document.getElementById("linkCorretor").value=`${location.origin}${location.pathname}?user=${user.username}`;
    loadImoveis(); loadSchedule();
  } else { document.getElementById("loginError").innerText="Usuário ou senha incorretos!"; }
}

// ---------- Adicionar/Editar Imóveis ----------
async function addOrUpdateImovel(){
  const imovel=document.getElementById("imovel").value.trim();
  if(!imovel){ alert("Informe o nome do imóvel!"); return; }
  const preco=document.getElementById("preco").value.trim();
  const endereco=document.getElementById("endereco").value.trim();
  const site=document.getElementById("site").value.trim();
  const descricao=document.getElementById("descricao").value.trim();
  const fotos=[];
  for(let i=1;i<=10;i++){ let val=document.getElementById(`foto${i}`).value.trim(); if(val) fotos.push(val); }
  await fetch(sheetUrl,{
    method:"POST",
    headers: headers,
    body: JSON.stringify({corretor:currentUser.username,imovel,preco,endereco,site,descricao,fotos:fotos.join(",")})
  });
  alert("Imóvel adicionado/atualizado com sucesso!");
  loadImoveis();
}

// ---------- Carregar Imóveis ----------
async function loadImoveis(){
  const res=await fetch(sheetUrl,{headers}); const data=await res.json();
  const imoveis = data.filter(i=>i.corretor===currentUser.username && i.imovel);
  const container=document.getElementById("cardsContainer");
  container.innerHTML="";
  imoveis.forEach(i=>{
    const card=document.createElement("div"); card.classList.add("card");
    card.innerHTML=`<h3>${i.imovel}</h3><p>Preço: ${i.preco}</p><p>Endereço: ${i.endereco}</p><p>${i.descricao}</p>`;
    if(i.fotos){ const imgs=i.fotos.split(","); const imgContainer=document.createElement("div"); imgContainer.classList.add("img-container"); imgs.forEach(src=>{ let img=document.createElement("img"); img.src=src; imgContainer.appendChild(img); }); card.appendChild(imgContainer);}
    container.appendChild(card);
  });
}

// ---------- Quadro de horários ----------
async function loadSchedule(){
  const container=document.getElementById("scheduleContainer");
  container.innerHTML="";
  const dias=["Seg","Ter","Qua","Qui","Sex","Sáb","Dom"];
  dias.forEach(d=>{
    const slot=document.createElement("div"); slot.classList.add("slot","available"); slot.innerText=d;
    slot.onclick=async ()=>{
      if(slot.classList.contains("available")){slot.classList.remove("available");slot.classList.add("occupied");} 
      else if(slot.classList.contains("occupied")){slot.classList.remove("occupied");slot.classList.add("personal");} 
      else{slot.classList.remove("personal");slot.classList.add("available");}
      // Aqui você pode integrar status do horário na Sheet Best
    };
    container.appendChild(slot);
  });
}

// ---------- Cliente via link ----------
window.onload=function(){
  const params=new URLSearchParams(window.location.search);
  const user=params.get("user");
  if(user){
    hideAll();
    document.getElementById("clientDiv").style.display="block";
    document.getElementById("clientCards").innerHTML="Carregando imóveis...";
    
    fetch(sheetUrl,{headers})
    .then(res=>res.json())
    .then(data=>{
      const imoveis = data.filter(i=>i.corretor===user && i.imovel);
      const container=document.getElementById("clientCards");
      container.innerHTML="";
      imoveis.forEach(i=>{
        const card=document.createElement("div"); card.classList.add("card");
        card.innerHTML=`<h3>${i.imovel}</h3><p>Preço: ${i.preco}</p><p>Endereço: ${i.endereco}</p><p>${i.descricao}</p>`;
        if(i.fotos){ 
          const imgs=i.fotos.split(",");
          const imgContainer=document.createElement("div"); imgContainer.classList.add("img-container");
          imgs.forEach(src=>{ let img=document.createElement("img"); img.src=src; imgContainer.appendChild(img); });
          card.appendChild(imgContainer);
        }
        container.appendChild(card);
      });
    });
  }
}
</script>
</body>
</html>

