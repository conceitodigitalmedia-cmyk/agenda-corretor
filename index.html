<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Agenda Corretor</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,Segoe UI,Arial,sans-serif}
body{background:#0f0f10;color:#fff;padding:18px;min-height:100vh}
h1,h2{ text-align:center;margin-bottom:14px }
.container{max-width:1100px;margin:0 auto}
#homeDiv{max-width:520px;margin:48px auto;text-align:center}
.btn{display:block;width:80%;margin:10px auto;padding:14px;border-radius:10px;border:none;color:#fff;font-weight:700;cursor:pointer}
.btn-blue{background:#2f8ef7}
.btn-green{background:#33c16b}
.btn-orange{background:#ff9800}
.box{max-width:720px;margin:18px auto;background:#121212;padding:18px;border-radius:10px;border:1px solid #222}
.input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:none;background:#141416;color:#fff}
.grid{display:grid;gap:12px}
.grid-cols-3{grid-template-columns:repeat(3,1fr)}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:16px}
.card{background:#141416;padding:14px;border-radius:10px;border:1px solid #2b2b2b}
.small{font-size:0.9rem;color:#ddd}
.schedule{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:12px}
.slot{padding:8px;border-radius:8px;text-align:center;cursor:pointer;font-weight:700}
.available{background:#2ecc71;color:#012}
.occupied{background:#e74c3c;color:#fff}
.personal{background:#f39c12;color:#111}
.linkbox{margin-top:14px;text-align:center}
.readonly{width:100%;padding:10px;border-radius:8px;border:none;background:#222;color:#fff}
.note{font-size:0.9rem;color:#bbb;margin-top:8px;text-align:center}
</style>
</head>
<body>
<div class="container">

  <!-- HOME -->
  <div id="homeDiv">
    <h1>Agenda Corretor</h1>
    <button class="btn btn-blue" onclick="showRegister()">Cadastro Corretor</button>
    <button class="btn btn-green" onclick="showLogin()">Login Corretor</button>
    <button class="btn btn-orange" onclick="showClient()">Acesso Cliente</button>
    <p class="note">Use o botão "Acesso Cliente" quando tiver o link do corretor (ex.: ?user=marcos)</p>
  </div>

  <!-- CADASTRO -->
  <div id="registerDiv" class="box" style="display:none">
    <h2>Cadastro de Corretor</h2>
    <input id="nome" class="input" placeholder="Nome (obrigatório)" />
    <input id="email" class="input" placeholder="E-mail" />
    <input id="telefone" class="input" placeholder="Telefone (obrigatório)" />
    <input id="creci" class="input" placeholder="CRECI (obrigatório)" />
    <input id="senha" class="input" type="password" placeholder="Senha (obrigatório)" />
    <button class="btn btn-blue" onclick="registerCorretor()">Cadastrar</button>
    <button class="btn" onclick="backHome()">Voltar</button>
    <p id="registerMsg" class="small" style="margin-top:10px"></p>
  </div>

  <!-- LOGIN -->
  <div id="loginDiv" class="box" style="display:none">
    <h2>Login Corretor</h2>
    <input id="username" class="input" placeholder="Usuário (nome em minúsculas)" />
    <input id="password" class="input" type="password" placeholder="Senha" />
    <button class="btn btn-green" onclick="login()">Entrar</button>
    <button class="btn" onclick="backHome()">Voltar</button>
    <p id="loginError" class="small" style="margin-top:10px;color:#ff7777"></p>
  </div>

  <!-- PAINEL CORRETOR -->
  <div id="panelDiv" class="box" style="display:none">
    <h1>Bem-vindo à Agenda do Corretor</h1>
    <h2 id="welcome" class="small" style="margin-bottom:10px"></h2>

    <div>
      <h3 style="margin-bottom:8px">Adicionar / Atualizar Imóvel</h3>
      <div class="grid">
        <input id="nomeImovel" class="input" placeholder="Nome do imóvel" />
        <input id="preco" class="input" placeholder="Preço" />
        <input id="endereco" class="input" placeholder="Endereço / Cidade" />
        <input id="site" class="input" placeholder="Site do imóvel" />
        <textarea id="descricao" class="input" rows="3" placeholder="Descrição"></textarea>
        <!-- fotos -->
        <input id="foto1" class="input" placeholder="Link Foto 1" />
        <input id="foto2" class="input" placeholder="Link Foto 2" />
        <input id="foto3" class="input" placeholder="Link Foto 3" />
        <input id="foto4" class="input" placeholder="Link Foto 4" />
        <input id="foto5" class="input" placeholder="Link Foto 5" />
        <input id="foto6" class="input" placeholder="Link Foto 6" />
        <input id="foto7" class="input" placeholder="Link Foto 7" />
        <input id="foto8" class="input" placeholder="Link Foto 8" />
        <input id="foto9" class="input" placeholder="Link Foto 9" />
        <input id="foto10" class="input" placeholder="Link Foto 10" />
      </div>
      <div style="margin-top:10px">
        <button class="btn btn-blue" onclick="addImovel()">Adicionar Imóvel</button>
      </div>
    </div>

    <div class="linkbox">
      <p class="small">Link individual do corretor para clientes:</p>
      <input id="linkCorretor" class="readonly" readonly />
    </div>

    <div style="margin-top:10px;text-align:center">
      <button class="btn" onclick="logout()">Sair</button>
    </div>
  </div>

  <!-- PAINEL CLIENTE -->
  <div id="clientDiv" class="box" style="display:none">
    <h2>Painel Cliente</h2>
    <div id="clientCards" class="cards"></div>
    <div id="clientScheduleTitle" style="margin-top:12px;text-align:center"></div>
    <div id="clientSchedule" class="schedule"></div>
    <div style="margin-top:12px;text-align:center">
      <button class="btn" onclick="backHome()">Voltar</button>
    </div>
  </div>

</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbw_YFcMh2bn5xYkmLcenyn2guQsMjtqiK0knuyiUCD-GaSqCSZF7uNeJZ_cTjDxiQ6dxQ/exec";

/* ===== Funções de navegação ===== */
function showRegister(){document.getElementById('homeDiv').style.display='none';document.getElementById('registerDiv').style.display='block'}
function showLogin(){document.getElementById('homeDiv').style.display='none';document.getElementById('loginDiv').style.display='block'}
function showClient(){document.getElementById('homeDiv').style.display='none';document.getElementById('clientDiv').style.display='block'}
function backHome(){document.getElementById('registerDiv').style.display='none';document.getElementById('loginDiv').style.display='none';document.getElementById('clientDiv').style.display='none';document.getElementById('panelDiv').style.display='none';document.getElementById('homeDiv').style.display='block'}

/* ===== Função de cadastro ===== */
async function registerCorretor(){
  const nome=document.getElementById('nome').value.trim()
  const email=document.getElementById('email').value.trim()
  const telefone=document.getElementById('telefone').value.trim()
  const creci=document.getElementById('creci').value.trim()
  const senha=document.getElementById('senha').value.trim()
  if(!nome||!telefone||!creci||!senha){document.getElementById('registerMsg').innerText='Preencha todos os campos obrigatórios!';return}
  try{
    const resp=await fetch(SHEET_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({type:"cadastro",nome,email,telefone,creci,senha})
    })
    const data=await resp.json()
    if(data.status=="ok"){document.getElementById('registerMsg').innerText='Cadastro realizado com sucesso!';setTimeout(()=>{backHome()},1500)}
    else{document.getElementById('registerMsg').innerText='Erro no cadastro.'}
  }catch(e){document.getElementById('registerMsg').innerText='Erro no cadastro: '+e.message}
}

/* ===== Função de login ===== */
async function login(){
  const user=document.getElementById('username').value.trim().toLowerCase()
  const pass=document.getElementById('password').value.trim()
  try{
    const resp=await fetch(SHEET_URL+'?action=getCorretores')
    const data=await resp.json()
    const found=data.find(c=>c.nome.toLowerCase()===user && c.senha===pass)
    if(found){
      document.getElementById('loginError').innerText=''
      openPanel(found)
    }else{document.getElementById('loginError').innerText='Usuário ou senha incorretos'}
  }catch(e){document.getElementById('loginError').innerText='Erro: '+e.message}
}

/* ===== Abrir painel do corretor ===== */
function openPanel(user){
  document.getElementById('loginDiv').style.display='none'
  document.getElementById('panelDiv').style.display='block'
  document.getElementById('welcome').innerText='Olá, '+user.nome
  document.getElementById('linkCorretor').value=window.location.href+'?user='+encodeURIComponent(user.nome.toLowerCase())
}

/* ===== Logout ===== */
function logout(){backHome()}

/* ===== Adicionar Imóvel ===== */
async function addImovel(){
  const nome=document.getElementById('nomeImovel').value.trim()
  const preco=document.getElementById('preco').value.trim()
  const endereco=document.getElementById('endereco').value.trim()
  const site=document.getElementById('site').value.trim()
  const descricao=document.getElementById('descricao').value.trim()
  const fotos=[]
  for(let i=1;i<=10;i++){const f=document.getElementById('foto'+i).value.trim();if(f)fotos.push(f)}
  if(!nome){alert('Preencha o nome do imóvel');return}
  try{
    const resp=await fetch(SHEET_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({type:"imovel",nome,preco,endereco,site,descricao,fotos})
    })
    const data=await resp.json()
    if(data.status=="ok"){alert('Imóvel adicionado!')}
    else{alert('Erro ao adicionar imóvel')}
  }catch(e){alert('Erro: '+e.message)}
}
</script>
</body>
</html>
